# Cloudflare Worker Configuration for MahdiArts Contact Form
# ساخته شده توسط مهدی باغبان‌پور

name = "mahdiarts-contact-form"
main = "workers/contact-form.js"
compatibility_date = "2024-01-01"
# account_id می‌تواند به صورت خودکار تشخیص داده شود، یا می‌توانید آن را از داشبورد Cloudflare دریافت کنید
# account_id = "YOUR_ACCOUNT_ID"
workers_dev = true

# تنظیمات Production
[env.production]
name = "mahdiarts-contact-form"
routes = [
  { pattern = "mahdiarts.ir/api/contact", zone_name = "mahdiarts.ir" },
  { pattern = "www.mahdiarts.ir/api/contact", zone_name = "mahdiarts.ir" },
  { pattern = "mahdiarts.ir/api/newsletter/subscribe", zone_name = "mahdiarts.ir" },
  { pattern = "mahdiarts.ir/api/newsletter/unsubscribe", zone_name = "mahdiarts.ir" },
  { pattern = "mahdiarts.ir/api/newsletter/publish", zone_name = "mahdiarts.ir" },
  { pattern = "www.mahdiarts.ir/api/newsletter/subscribe", zone_name = "mahdiarts.ir" },
  { pattern = "www.mahdiarts.ir/api/newsletter/unsubscribe", zone_name = "mahdiarts.ir" },
  { pattern = "www.mahdiarts.ir/api/newsletter/publish", zone_name = "mahdiarts.ir" }
]

[env.production.vars]
# Only production domains for CORS
ALLOWED_ORIGINS = "https://mahdiarts.ir,https://www.mahdiarts.ir"
# Ensure FROM_EMAIL exists in production
FROM_EMAIL = "noreply@mahdiarts.ir"
# Admin email must be set explicitly for production
ADMIN_EMAIL = "info@mahdiarts.ir"

# تنظیمات Dev (برای تست و ذخیره Secret های محیط dev)
[env.dev]
name = "mahdiarts-contact-form-dev"
workers_dev = true

[env.dev.vars]
FROM_EMAIL = "noreply@mahdiarts.ir"
ADMIN_EMAIL = "info@mahdiarts.ir"
ALLOWED_ORIGINS = "http://localhost:8787,http://127.0.0.1:8787,https://mahdiarts.ir,http://127.0.0.1:8080,http://localhost:8080"

# Environment Variables
[vars]
# دامنه‌های مجاز برای CORS (با کاما جدا کنید)
ALLOWED_ORIGINS = "https://mahdiarts.ir,https://www.mahdiarts.ir"
# ایمیل ادمین برای دریافت پیام‌ها
ADMIN_EMAIL = "info@mahdiarts.ir"
# URL عمومی R2 برای دسترسی به فایل‌ها (اختیاری)
# R2_PUBLIC_URL = "https://files.mahdiarts.ir"

# Secret Bindings (باید از طریق wrangler secret put تنظیم شوند)
# wrangler secret put RESEND_API_KEY
# wrangler secret put RESEND_API_KEY --env production

# wrangler secret put NEWSLETTER_PUBLISH_KEY
# wrangler secret put NEWSLETTER_PUBLISH_KEY --env production

# KV Namespace برای Rate Limiting
# برای ایجاد KV namespace:
# wrangler kv:namespace create "RATE_LIMIT_KV"
# wrangler kv:namespace create "RATE_LIMIT_KV" --env production
# پس از ایجاد namespace، ID های زیر را از خروجی دستورات بالا کپی کنید
# [[kv_namespaces]]
# binding = "RATE_LIMIT_KV"
# id = "YOUR_KV_NAMESPACE_ID"
# preview_id = "YOUR_PREVIEW_KV_NAMESPACE_ID"

# [[kv_namespaces]]
# binding = "NEWSLETTER_KV"
# id = "YOUR_NEWSLETTER_KV_NAMESPACE_ID"
# preview_id = "YOUR_NEWSLETTER_KV_PREVIEW_ID"

# R2 Bucket برای آپلود فایل‌ها (اختیاری)
# برای ایجاد R2 bucket:
# wrangler r2 bucket create mahdiarts-uploads
